- !policy
  id: foo
  annotations:
    description: Policy for application Foo
  body:
    - !group developers
    - !group team_leads
    - !group security_ops

    - !group uses_staging_variables
    - !group uses_production_variables

    - !group sets_staging_variables
    - !group sets_production_variables

    - !layer &staging-layer
      id: staging
      annotations:
        description: Layer for the Foo Staging host(s)

    - !layer &production-layer
      id: production
      annotations:
        description: Layer for the Foo Staging host(s)

    - !host-factory
      id: staging
      annotations:
        description: Host Factory for Jenkins master hosts
      layer: [ *staging-layer ]

    - !host-factory
      id: production
      annotations:
        description: Host Factory for Jenkins master hosts
      layer: [ *production-layer ]

    - !variable
      id: staging/database/username
      annotations:
        description: Application database username
    - !variable
      id: staging/database/password
      annotations:
        description: Application database password
    - !variable
      id: staging/stripe/private_key
      annotations:
        description: Stripe key for Sandbox environment

    - !variable
      id: production/database/username
      annotations:
        description: Application database username
    - !variable
      id: production/database/password
      annotations:
        description: Application database password
    - !variable
      id: production/stripe/private_key
      annotations:
        description: Stripe key for Sandbox environment

    - !permit
      role: !group uses_staging_variables
      privilege: [ read, execute ]
      resource:
        - !variable staging/database/username
        - !variable staging/database/password
        - !variable staging/stripe/private_key

    - !permit
      role: !group sets_staging_variables
      privilege: [ update ]
      resource:
        - !variable staging/database/username
        - !variable staging/database/password
        - !variable staging/stripe/private_key

    - !permit
      role: !group uses_production_variables
      privilege: [ read, execute ]
      resource:
        - !variable production/database/username
        - !variable production/database/password
        - !variable production/stripe/private_key

    - !permit
      role: !group sets_production_variables
      privilege: [ update ]
      resource:
        - !variable production/database/username
        - !variable production/database/password
        - !variable production/stripe/private_key

    - !grant
      role: !group sets_production_variables
      members:
        - !group security_ops

    - !grant
      role: !group sets_staging_variables
      members:
        - !group team_leads
        - !group security_ops

    - !grant
      role: !group uses_staging_variables
      members:
        - !group developers
        - !layer staging

    - !grant
      role: !group uses_staging_variables
      members:
        - !layer production
